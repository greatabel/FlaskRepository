L1

use innerHTML to escape <script> </script> tags.
I invoke js function htmlEncode when form is submited, to 
change users's input tags into escaped ones.

Main function :

function htmlEncode ( str ) {
 var ele = document.createElement('span');
 ele.appendChild( document.createTextNode( str ) );
 return ele.innerHTML;
}


function htmlDecode ( str ) {
 var ele = document.createElement('span');
 ele.innerHTML = str;
 return ele.textContent;
}


L2
alter javascript in index.html,
make input tags into escaped ones, before insert message into local db.:


console.log(message);
message = message.replace(/</g, "&lt;").replace(/>/g, "&gt;");
console.log(message);


L3
chooseTab(unescape(parseInt(self.location.hash.substr(1))))
Using parseInt javascript function to prevent malicious users from modify the URL.
 If the user input #4' onerror="alert()" alt='exploited_image, 
 the parsed result will become only #4, the js injection would not work.